<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.campick.mycontroller.ICampgroundSearchDAO">

	<select id="campgroundSearchList" resultType="com.campick.dto.CampgroundDTO">
		SELECT CAMPGROUNDID, CAMPGROUNDNAME, SIGNUPDATE, ADDRESS1, ADDRESS2, ADDRESS3
		, EXTRAINFO
		, PICKCOUNT AS PICK
		, FIREWOOD
		, REVIEWCOUNT AS REVIEW
		, (SELECT ROOMTYPELIST FROM CAMPGROUND_TY_OP_TH_VIEW WHERE C.CAMPGROUNDID=CAMPGROUNDID) AS ROOMTYPELIST
		, (SELECT OPTIONLIST FROM CAMPGROUND_TY_OP_TH_VIEW WHERE C.CAMPGROUNDID=CAMPGROUNDID) AS OPTIONLIST
		, (SELECT THEMELIST FROM CAMPGROUND_TY_OP_TH_VIEW WHERE C.CAMPGROUNDID=CAMPGROUNDID) AS THEMELIST
		FROM CAMPGROUND_VIEW C
		WHERE (CAMPGROUNDNAME || EXTRAINFO || ADDRESS1 || ADDRESS2 || ADDRESS3) LIKE '%'|| #{keyword} ||'%' 
		ORDER BY ${sortkey} ${sortvalue}
	</select>
	
	<select id="campgroundSearchListCount" resultType="java.lang.Integer">
		
		SELECT COUNT(*)
		FROM
		(
			SELECT CAMPGROUNDID, CAMPGROUNDNAME, SIGNUPDATE, ADDRESS1, ADDRESS2, ADDRESS3
		    , EXTRAINFO
		    , PICKCOUNT AS PICK
		    , FIREWOOD
		    , REVIEWCOUNT AS REVIEW
		    , (SELECT ROOMTYPELIST FROM CAMPGROUND_TY_OP_TH_VIEW WHERE C.CAMPGROUNDID=CAMPGROUNDID) AS ROOMTYPELIST
		    , (SELECT OPTIONLIST FROM CAMPGROUND_TY_OP_TH_VIEW WHERE C.CAMPGROUNDID=CAMPGROUNDID) AS OPTIONLIST
		    , (SELECT THEMELIST FROM CAMPGROUND_TY_OP_TH_VIEW WHERE C.CAMPGROUNDID=CAMPGROUNDID) AS THEMELIST
		    FROM CAMPGROUND_VIEW C
		    WHERE (CAMPGROUNDNAME || EXTRAINFO || ADDRESS1 || ADDRESS2 || ADDRESS3) LIKE '%'|| #{keyword} ||'%' 
			ORDER BY ${sortkey} ${sortvalue}
		)
	</select>
	
	
	<select id="campgroundSearchListCheck" resultType="com.campick.dto.CampgroundDTO">
		SELECT CAMPGROUNDID, CAMPGROUNDNAME, SIGNUPDATE, ADDRESS1, ADDRESS2, ADDRESS3
		, EXTRAINFO
		, PICKCOUNT AS PICK
		, FIREWOOD
		, REVIEWCOUNT AS REVIEW
		, (SELECT ROOMTYPELIST FROM CAMPGROUND_TY_OP_TH_VIEW WHERE C.CAMPGROUNDID=CAMPGROUNDID) AS ROOMTYPELIST
		, (SELECT OPTIONLIST FROM CAMPGROUND_TY_OP_TH_VIEW WHERE C.CAMPGROUNDID=CAMPGROUNDID) AS OPTIONLIST
		, (SELECT THEMELIST FROM CAMPGROUND_TY_OP_TH_VIEW WHERE C.CAMPGROUNDID=CAMPGROUNDID) AS THEMELIST
		FROM CAMPGROUND_VIEW C
		WHERE CAMPGROUNDID IN((SELECT CAMPGROUNDID FROM CAMPGROUND_SEARCH_VIEW
		WHERE ROOMTYPENUM = ANY(${type})
		    OR OPTIONNUM = ANY(${option})
		    OR THEMENUM = ANY(${theme})
		    <if test="keyword != ''">
		    	OR (CAMPGROUNDNAME || EXTRAINFO || ADDRESS1 || ADDRESS2 || ADDRESS3) LIKE '%'|| #{keyword} ||'%'
		    </if>
		    GROUP BY CAMPGROUNDID))
		ORDER BY ${sortkey} ${sortvalue}
	</select>
	
	<select id="campgroundSearchListCheckCount" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM
		(
			SELECT CAMPGROUNDID, CAMPGROUNDNAME, SIGNUPDATE, ADDRESS1, ADDRESS2, ADDRESS3
			, EXTRAINFO
			, PICKCOUNT AS PICK
			, FIREWOOD
			, REVIEWCOUNT AS REVIEW
			, (SELECT ROOMTYPELIST FROM CAMPGROUND_TY_OP_TH_VIEW WHERE C.CAMPGROUNDID=CAMPGROUNDID) AS ROOMTYPELIST
			, (SELECT OPTIONLIST FROM CAMPGROUND_TY_OP_TH_VIEW WHERE C.CAMPGROUNDID=CAMPGROUNDID) AS OPTIONLIST
			, (SELECT THEMELIST FROM CAMPGROUND_TY_OP_TH_VIEW WHERE C.CAMPGROUNDID=CAMPGROUNDID) AS THEMELIST
			FROM CAMPGROUND_VIEW C
			WHERE CAMPGROUNDID IN((SELECT CAMPGROUNDID FROM CAMPGROUND_SEARCH_VIEW
			WHERE ROOMTYPENUM = ANY(${type})
			    OR OPTIONNUM = ANY(${option})
			    OR THEMENUM = ANY(${theme})
			    <if test="keyword != ''">
			    	OR (CAMPGROUNDNAME || EXTRAINFO || ADDRESS1 || ADDRESS2 || ADDRESS3) LIKE '%'|| #{keyword} ||'%'
			    </if>
			    GROUP BY CAMPGROUNDID))
			ORDER BY ${sortkey} ${sortvalue}
		)
	</select>

</mapper>


